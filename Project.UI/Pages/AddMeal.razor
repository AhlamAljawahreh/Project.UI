
@page "/new_meals"
@using Project.DataModels;
@using Project.UI.Services;
@inject IProductServices _productService;
@inject IPhotoService _photoService;

@using Microsoft.AspNetCore.Http;


    @inject NavigationManager NavigationManager;
    @using Microsoft.AspNetCore.Components.Server.ProtectedBrowserStorage;
    @inject ProtectedLocalStorage BrowserStorage




    @code {
        private IFormFile file { set; get; }
        private Product product { set; get; } = new Product();
        public async void onSubmit()
        {
            if(product.Image != null)
            {
                var httpResponse = await _productService.AddMeal(product);

                if (httpResponse.name == product.name)
                {
                    NavigationManager.NavigateTo("/meals");
                }
            }

        }
        private async void upload(InputFileChangeEventArgs e)
        {
            Console.WriteLine("hiiiiiii");
            Console.WriteLine(e.ToString());
            var httpResponse = await _photoService.AddItemPhotoAsync(e.File);
            Console.WriteLine($"Done {httpResponse.SecureUrl}");
            product.Image = httpResponse.SecureUrl.ToString();
        }


    }

    <h3>AddMeal</h3>
    <div class="card">
        <h3>Login</h3>
        <div class="card-body">
            <EditForm Model=@product OnSubmit="@onSubmit">
                <div class="form-group">
                    <label>UserName</label>
                    <InputText id="username" class="form-control" name="userName" @bind-Value="product.name"></InputText>
                </div>
                <div class="form-group">
                    <label>Description </label>
                    <InputText id="Description" class="form-control" name="Description" @bind-Value="product.Description"></InputText>
                </div>
                <div class="form-group">
                    <label>Password </label>
                    <InputNumber id="Price" type="number" class="form-control" name="Price" @bind-Value="product.Price"></InputNumber>
                </div>
                <div class="form-group">
                    <label>Images </label>
                    <InputFile OnChange="upload" id="Password" class="form-control" name="Password"></InputFile>

                </div>
                <button type="submit" class="btn btn-info">Login</button>
            </EditForm>
        </div>



    </div>

